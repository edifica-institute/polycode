/* ===== TOKENS ======================================================= */
:root{
  color-scheme: dark;
  --bg:#16181b; --text:#e9edf3; --muted:#aeb5bd;
  --panel:#1e2024; --panel-2:#1a1c1f; --border:#2b2f34;
  --glass:rgba(255,255,255,.05); --glass-brd:rgba(255,255,255,.12);
  --brand:#2e5bea; --ok:#7dffa0; --err:#ff8b8b; --link:#9ecbff;
  --shadow-3d:0 24px 60px rgba(0,0,0,.35),0 10px 24px rgba(0,0,0,.22);
  --outer-gap:8px;
}
body.light{
  color-scheme: light;
  --bg:#eef2f7; --text:#0b0b0b; --muted:#6b7280;
  --panel:#fff; --panel-2:#f1f4f9; --border:#d7dbe2;
  --glass:rgba(0,0,0,.05); --glass-brd:rgba(0,0,0,.12);
  --brand:#2457ff; --ok:#22985a; --err:#cc2f2f; --link:#204ecf;
  --shadow-3d:0 24px 60px rgba(0,0,0,.12),0 10px 24px rgba(0,0,0,.08);
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; background:var(--bg); color:var(--text);
  font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  display:grid; grid-template-rows:auto 1fr auto; overflow:hidden;
}

/* ===== HEADER (logo left • links right) ============================ */
.site-header{
  position:sticky; top:0; z-index:50;
  display:grid; grid-template-columns:auto 1fr auto; align-items:center;
  gap:12px; padding:10px 16px; background:var(--glass);
  border-bottom:1px solid var(--glass-brd); backdrop-filter:blur(10px);
}
.brand-wrap{display:flex; align-items:center; gap:10px}
.brand-grid{display:grid; grid-template-columns:auto 1fr; grid-template-rows:auto auto; column-gap:10px; row-gap:2px; align-items:center}
.brand-logo{grid-row:1/3; width:48px; height:48px; object-fit:contain}
.brand-title2{font:400 clamp(24px,2.6vw,34px)/1.05 system-ui; letter-spacing:.2px; white-space:nowrap}
.brand-tagline2{font: clamp(12px,1.3vw,14px)/1.1 system-ui; color:var(--muted); white-space:nowrap}
.site-nav, .site-header nav{display:flex; gap:16px; justify-self:end}
.site-header a{color:var(--text); text-decoration:underline; text-underline-offset:3px}
.site-header a:hover{color:var(--brand)}

/* ===== STAGE / APP / PANELS ======================================= */
.stage{padding-block:var(--outer-gap); padding-inline:12px}
.app{
  height:100%; min-height:0; display:grid; gap:8px;
  grid-template-columns:280px 8px minmax(360px,1fr) 8px minmax(360px,42%);
  grid-template-rows:1fr;
}
.app.collapsed-left{grid-template-columns:0 0 minmax(560px,1fr) 8px minmax(340px,42%)}
.panel{
  display:flex; flex-direction:column; min-width:0; min-height:0;
  background:linear-gradient(180deg,var(--panel),color-mix(in oklab,var(--panel),#000 4%));
  border:1px solid var(--border); border-radius:0; overflow:hidden; box-shadow:var(--shadow-3d)
}
.pane-head{
  display:flex; align-items:center; gap:10px; padding:12px;
  background:var(--glass); border-bottom:1px solid var(--glass-brd); backdrop-filter:blur(10px);
  font-weight:500
}
.select{background:var(--panel); color:var(--text); border:1px solid var(--border); border-radius:0; padding:8px 10px; width:100%}
.left.panel{grid-column:1/span 1}
.center.panel{grid-column:3/span 1}
.right.panel{grid-column:5/span 1}
#editor{flex:1 1 0; min-height:0}
#output{flex:1 1 0; min-height:0; overflow:auto; padding:12px; background:transparent !important; color:var(--text)}
#output *, #output table, #output pre{background-color:transparent !important}
#jconsole{display:inline-block; min-width:100%; white-space:pre; overflow:visible}

/* Resizers */
.v-resize{width:8px; cursor:col-resize}
.v-resize>div{width:100%; height:100%; background:transparent}
.v-resize>div:hover{background:var(--glass)}

/* Frozen visual */
.panel.frozen{filter:saturate(.85) brightness(.92)}
.panel.frozen .pane-head{filter:grayscale(.2)}
.right.panel.frozen,.right.panel.frozen .pane-head{filter:none !important}

/* ===== BUTTONS & ANIMATIONS (only state-based) ===================== */
.btn{
  width:36px; height:36px; padding:0; border-radius:0;
  border:1px solid var(--glass-brd); background:var(--glass); color:var(--text);
  cursor:pointer; display:inline-grid; place-items:center;
  transition:transform .15s ease, box-shadow .2s ease
}
.btn svg{width:18px; height:18px; fill:currentColor}
.btn:hover{transform:translateY(-1px)}
.btn:disabled{opacity:.6; cursor:not-allowed}

@keyframes glowPulse{0%,100%{box-shadow:0 0 0 currentColor}50%{box-shadow:0 0 18px currentColor,0 0 34px currentColor}}
@keyframes shakeStrong{/* no-op to keep layout stable */}

.btn.is-running, .btn.is-running:disabled,
.btn.is-resetting, .btn.is-resetting:disabled{
  animation:glowPulse 1.2s ease-in-out infinite, shakeStrong .5s linear infinite !important;
  will-change:transform, box-shadow;
}
@media (prefers-reduced-motion:reduce){
  .btn.is-running, .btn.is-running:disabled,
  .btn.is-resetting, .btn.is-resetting:disabled{animation:none !important; box-shadow:none !important}
}

/* Pyplot special button */
#btnPlotPreview{position:relative; border:none !important; background:#000 !important; color:#fff !important}
#btnPlotPreview:disabled{opacity:.6; cursor:not-allowed}
@keyframes glowWhite{0%,100%{box-shadow:0 0 0 rgba(255,255,255,0)}50%{box-shadow:0 0 12px rgba(255,255,255,.9),0 0 20px rgba(255,255,255,.6)}}
#btnPlotPreview:not([disabled])::after{
  content:""; position:absolute; inset:0; border-radius:inherit; pointer-events:none; animation:glowWhite 1.2s ease-in-out infinite
}

/* ===== PANE FOOT / STATUS CHIPS ==================================== */
.pane-foot{
  border-top:1px solid var(--glass-brd); background:var(--glass);
  padding:8px 10px; font-size:12.5px; display:flex; align-items:center
}
.pane-foot .msg.status{display:inline-flex; align-items:center; gap:8px; font-weight:500}
.pane-foot .msg.status .icon{width:12px; height:12px; border-radius:999px; position:relative}
.pane-foot .status.ready{color:var(--ok)}
.pane-foot .status.waiting,.pane-foot .status.running{color:var(--brand)}
.pane-foot .status.success{color:var(--ok)}
.pane-foot .status.error{color:var(--err)}
@keyframes pulseDot{0%,100%{transform:scale(1); box-shadow:0 0 0 0 currentColor}50%{transform:scale(1.15); box-shadow:0 0 10px 2px color-mix(in oklab,currentColor,transparent 60%)}}
@keyframes breath{0%,100%{box-shadow:0 0 0 0 currentColor}50%{box-shadow:0 0 8px 2px color-mix(in oklab,currentColor,transparent 60%)}}
@keyframes dot{0%,20%{opacity:.2; transform:translateY(0)}50%{opacity:1; transform:translateY(-2px)}80%,100%{opacity:.2; transform:translateY(0)}}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes popIn{0%{transform:scale(.6);opacity:0}60%{transform:scale(1.2)}100%{transform:scale(1);opacity:1}}

.pane-foot .status.ready .icon{background:currentColor; animation:pulseDot 1.2s ease-in-out infinite}
.pane-foot .status.waiting .icon{border:2px solid currentColor; background:transparent; animation:breath 1.4s ease-in-out infinite}
.pane-foot .status.waiting .dots span,
.pane-foot .status.running .dots span{display:inline-block; width:4px; height:4px; border-radius:999px; background:currentColor; margin-left:3px; animation:dot 1.2s ease-in-out infinite}
.pane-foot .status.waiting .dots span:nth-child(2),
.pane-foot .status.running .dots span:nth-child(2){animation-delay:.2s}
.pane-foot .status.waiting .dots span:nth-child(3),
.pane-foot .status.running .dots span:nth-child(3){animation-delay:.4s}
.pane-foot .status.running .icon{border:2px solid transparent; border-top-color:currentColor; border-left-color:currentColor; animation:spin .8s linear infinite}
.pane-foot .status.success .icon{border:2px solid currentColor; background:transparent}
.pane-foot .status.success .icon::before{content:"✓"; position:absolute; inset:0; display:grid; place-items:center; font-size:10px; font-weight:700; color:currentColor; animation:popIn .35s ease-out both}
.pane-foot .status.error .icon{border:2px solid currentColor; background:transparent}
.pane-foot .status.error .icon::before{content:"✕"; position:absolute; inset:0; display:grid; place-items:center; font-size:10px; font-weight:700; color:currentColor}
@media (prefers-reduced-motion:reduce){
  .pane-foot .msg.status .icon,.pane-foot .status .dots span{animation:none !important}
}

/* Pane-specific colors */
#leftFoot{color:#f59e0b !important}
#centerFoot{color:var(--ok) !important}
#rightFoot{color:var(--brand) !important}
#rightFoot.error, #rightFoot.status.error{color:var(--err) !important}

/* ===== LINKS & FOOTER ============================================== */
a{color:var(--link); text-decoration:underline; text-underline-offset:3px}
a:hover{color:#ffa043}
.site-footer{
  margin-top:12px; padding:18px 24px; background:var(--glass);
  border-top:1px solid var(--glass-brd); box-shadow:var(--shadow-3d); position:relative; z-index:2
}
.footer-grid{display:grid; grid-template-columns:1fr auto 1fr; align-items:center; gap:16px}
.footer-left{display:flex; align-items:center; gap:10px}
.footer-left .txt{display:flex; flex-direction:column; gap:2px; line-height:1.1}
.footer-left .txt .powered{font-size:15px; font-weight:500}
.footer-left .txt .subline,.footer-left .txt .siteurl{font-size:10px; color:var(--muted)}
.footer-center{display:flex; align-items:center; gap:12px; justify-content:center}
.footer-center .label{font-size:12px; color:var(--muted)}
.footer-center .social{display:inline-flex; width:28px; height:28px}
.footer-center .social svg{width:18px; height:18px; fill:currentColor}
.footer-right{display:flex; gap:16px; justify-content:center} /* centered nav links per request */

/* Follow us right on mobile */
@media (max-width:640px){
  .footer-grid{grid-template-columns:1fr; row-gap:10px}
  .footer-left{justify-content:flex-start}
  .footer-right{justify-content:center; flex-wrap:wrap; gap:12px}
  .footer-center{justify-content:flex-end} /* "Follow us" to the right */
}

/* ===== MODAL (Complexity) ========================================== */
.pc-modal{position:fixed; inset:0; display:none; place-items:center; z-index:1000}
.pc-modal[aria-hidden="false"]{display:grid}
.pc-modal__backdrop{position:absolute; inset:0; background:rgba(0,0,0,.45)}
.pc-modal__dialog{
  position:relative; width:min(90vw,820px); max-height:80vh; margin:0; overflow:hidden;
  display:flex; flex-direction:column; background:var(--panel,#111);
  color:inherit; border:1px solid rgba(255,255,255,.1); border-radius:0; box-shadow:0 20px 50px rgba(0,0,0,.35); padding:14px
}
.pc-modal__header{display:flex; align-items:center; justify-content:space-between}
.pc-modal__body{overflow:auto}
.pc-modal__footer{display:flex; justify-content:flex-end; gap:8px}
.cx-summary{display:flex; justify-content:space-between; align-items:center; gap:20px; margin:6px 0 10px}
.cx-table{width:100%; border-collapse:collapse; font:13px/1.4 ui-monospace,Menlo,Consolas,monospace}
.cx-table th,.cx-table td{border-bottom:1px solid rgba(127,127,127,.25); padding:6px 8px; vertical-align:top}
.cx-table th{position:sticky; top:0; background:inherit; text-align:left}
.pc-modal__close{
  width:32px; height:32px; display:inline-grid; place-items:center;
  background:transparent; border:1px solid rgba(127,127,127,.35); border-radius:8px; color:inherit; cursor:pointer;
  transition:background .2s, border-color .2s, color .2s, transform .08s
}
.pc-modal__close:hover{background:rgba(127,127,127,.15); border-color:rgba(127,127,127,.55); color:var(--brand)}
.pc-modal__close:active{transform:translateY(1px)}
.pc-modal__close:focus-visible{outline:2px solid var(--brand); outline-offset:2px}

/* ===== UTILITIES ==================================================== */
.page-fade{animation:pageIn .55s ease-out both}
@keyframes pageIn{from{opacity:0; transform:translateY(6px)} to{opacity:1; transform:none}}
.page-fade .site-header{animation-delay:.02s}
.page-fade .stage,.page-fade .app{animation-delay:.06s}
.page-fade .site-footer{animation-delay:.10s}
@media (prefers-reduced-motion:reduce){
  .page-fade,.page-fade .site-header,.page-fade .stage,.page-fade .app,.page-fade .site-footer{animation:none !important}
}

.screen-dim{opacity:.55} /* stays scrollable */

/* ===== RESPONSIVE: STACKED MOBILE/TABLET (≤1024px) ================= */
@media (max-width:1024px){
  html,body{overflow-y:auto !important; overflow-x:hidden !important}
  .stage{padding:8px 12px}
  .app{display:flex !important; flex-direction:column !important; gap:8px !important; height:auto !important; min-height:0 !important}
  .v-resize{display:none !important}
  .left.panel{display:none !important}
  .app:not(.collapsed-left) .left.panel{display:block !important}
  .pane-head{padding:8px 10px; min-height:36px; flex-wrap:wrap}
  .btn{width:36px; height:36px}
  #editor{min-height:clamp(260px,54svh,62svh) !important; flex:1 1 0}
  #output{min-height:clamp(200px,36svh,46svh) !important; flex:1 1 0; overflow:auto !important}

  /* header sizing */
  .brand-logo{width:26px; height:26px}
  .brand-title2{font-size:18px; line-height:1.05; font-weight:400}
  .brand-tagline2{font-size:10px; line-height:1.1}

  /* footer fit */
  .site-footer{padding:10px 12px}
}

/* phones */
@media (max-width:640px){
  .site-header{padding:12px 14px}
  .footer-grid{grid-template-columns:1fr; row-gap:10px}
}
