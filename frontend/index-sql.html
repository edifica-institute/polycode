<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>SQL - EDIFICA PolyCode</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="./assets/logo.png" />
  <style>
    :root { color-scheme: dark; }
    body { margin:0; background:#111; color:#ddd; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    header { display:flex; align-items:center; gap:12px; background:#1a1a1a; padding:10px 14px; }
    header img { height:26px; width:26px; border-radius:50%; }
    header h1 { font-size:18px; margin:0; font-weight:600; }
    header .right { margin-left:auto; display:flex; gap:8px; align-items:center; }
    button { padding:6px 10px; border:0; border-radius:6px; background:#2e5bea; color:#fff; cursor:pointer; }
    button.secondary { background:#2a2a2a; color:#eee; }
    #status.ok { color:#83ffa6; }
    #status.err { color:#ff8b8b; }
    #spinner { display:none; width:14px; height:14px; border:2px solid #888; border-top-color:transparent; border-radius:50%; animation:spin 1s linear infinite; }
    @keyframes spin { to { transform:rotate(360deg); } }
    #main { display:grid; grid-template-columns: 1fr 1fr; height: calc(100vh - 52px); }
    #editor { height: 100%; }
    #right { padding:12px; overflow:auto; border-left: 1px solid #222; }
    #sqlout table { border-collapse: collapse; }
    #sqlout th, #sqlout td { border:1px solid #444; padding:6px 8px; }
    #sqlout pre { white-space: pre-wrap; }
    select { background:#2a2a2a; color:#eee; border:1px solid #444; border-radius:6px; padding:6px; }
  </style>
</head>
<body>
  <header>
    <img src="./assets/logo.png" alt="EDIFICA" />
    <h1>SQL - EDIFICA PolyCode</h1>
    <div class="right">
      <span id="status" class="ok">Ready</span>
      <span id="spinner"></span>
      <button id="runBtn">Run</button>
      <button id="clearBtn" class="secondary">Clear</button>
      <select id="langSelect" onchange="location.href=this.value">
        <option value="./index-sql.html" selected>SQL</option>
        <option value="./index-web.html">HTML/CSS/JS</option>
        <option value="./index-java.html">Java</option>
        <option value="./index-c.html">C</option>
        <!-- add more as you publish them: index-cpp.html, index-python.html, etc. -->
      </select>
    </div>
  </header>

  <div id="main">
    <div id="editor"></div>
    <div id="right">
      <h3>Result</h3>
      <div id="sqlout">(output will appear here)</div>
    </div>
  </div>

  <!-- Monaco AMD loader -->
  <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs/loader.min.js"></script>
  <!-- sql.js (WASM runner for SQLite) -->
  <script src="https://cdn.jsdelivr.net/npm/sql.js@1.10.2/dist/sql-wasm.js"></script>

  <script>
    // ---- Monaco init ----
    const SAMPLE_SQL =
`-- In-browser SQL (sql.js)
CREATE TABLE users(id INTEGER, name TEXT);
INSERT INTO users VALUES (1,'Alice'),(2,'Bob');
SELECT * FROM users;`;

    require.config({ paths: { vs: 'https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs' } });

    let editor, db;
    require(['vs/editor/editor.main'], async function () {
      editor = monaco.editor.create(document.getElementById('editor'), {
        value: SAMPLE_SQL,
        language: 'sql',
        theme: 'vs-dark',
        automaticLayout: true
      });

      // init sql.js
      const SQL = await window.initSqlJs({
        locateFile: f => 'https://cdn.jsdelivr.net/npm/sql.js@1.10.2/dist/' + f
      });
      db = new SQL.Database();
      setStatus('Ready', 'ok');
    });

    // ---- UI helpers ----
    function setStatus(text, kind) {
      const el = document.getElementById('status');
      el.textContent = text;
      el.className = kind || '';
    }
    function spin(on) {
      document.getElementById('spinner').style.display = on ? 'inline-block' : 'none';
    }

    // ---- Run / Clear ----
    async function runSQL() {
      if (!db) return;
      spin(true); setStatus('Runningâ€¦');
      const out = document.getElementById('sqlout');
      out.innerHTML = '';
      try {
        const res = db.exec(editor.getValue());
        if (!res.length) { out.textContent = '(no rows)'; setStatus('OK', 'ok'); return; }
        const { columns, values } = res[0];
        const table = document.createElement('table');
        const thead = document.createElement('thead'); const trh = document.createElement('tr');
        columns.forEach(c => { const th = document.createElement('th'); th.textContent = c; trh.appendChild(th); });
        thead.appendChild(trh);
        const tbody = document.createElement('tbody');
        values.forEach(row => {
          const tr = document.createElement('tr');
          row.forEach(cell => { const td = document.createElement('td'); td.textContent = String(cell); tr.appendChild(td); });
          tbody.appendChild(tr);
        });
        table.appendChild(thead); table.appendChild(tbody);
        out.appendChild(table);
        setStatus('OK', 'ok');
      } catch (e) {
        out.innerHTML = '<pre>' + (e && e.message ? e.message : String(e)) + '</pre>';
        setStatus('Error', 'err');
      } finally { spin(false); }
    }

    function clearSQL() {
      document.getElementById('sqlout').innerHTML = '';
      setStatus('Cleared', 'ok');
    }

    document.getElementById('runBtn').addEventListener('click', runSQL);
    document.getElementById('clearBtn').addEventListener('click', clearSQL);
  </script>
</body>
</html>
