<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>polycode | C</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="./assets/logo.png" />
  <link rel="stylesheet" href="./css/shell.css" />
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <meta name="color-scheme" content="dark light" />

  <style>
    /* --- small page-local tweaks --- */
    #consoleRow span{ background:transparent!important; padding:0!important; border-radius:0!important }
    #consoleInput{ display:inline-block; min-width:5ch; background:transparent; border:0; outline:0; box-shadow:none; caret-color: currentColor; user-select:text; -webkit-user-modify: read-write-plaintext-only; }
    #consoleInput:focus{ outline:0 }
    #consoleInput::selection{ background:rgba(255,255,255,.15) }
    .btn[disabled], .btn.attn[disabled]{ animation:none!important }
    .pane-foot .msg{ white-space:nowrap }
    .panel .pane-head{ display:flex; align-items:center }

    /* keep grid from snapping back due to intrinsic min-widths */
    .app, .panel, .pane-body, #editor, #output, #jconsole { min-width: 0; }
    .v-resize{ cursor: col-resize; user-select: none; }
    /* wrap output lines so they don't force panel growth; always autoscroll (JS also sets scrollLeft) */
    #jconsole{ white-space: pre; overflow: auto; }

    /* Complexity modal */
    .pc-modal { position: fixed; inset: 0; display: none; z-index: 1000; }
    .pc-modal[aria-hidden="false"] { display:block; }
    .pc-modal__backdrop{ position:absolute; inset:0; background:rgba(0,0,0,.45); }
    .pc-modal__dialog{ position:relative; margin:5vh auto; max-width:800px; background:var(--panel, #111); color:inherit; border:1px solid rgba(255,255,255,.1); border-radius:14px; box-shadow:0 20px 50px rgba(0,0,0,.35); padding:14px; }
    .pc-modal__header{ display:flex; align-items:center; justify-content:space-between; }
    .pc-modal__body{ max-height:60vh; overflow:auto; }
    .pc-modal__footer{ display:flex; justify-content:flex-end; gap:8px; }
    .cx-summary{ display:grid; grid-template-columns:1fr 1fr; gap:10px; margin:6px 0 10px; }
    .cx-table{ width:100%; border-collapse: collapse; font:13px/1.4 ui-monospace, Menlo, Consolas, monospace; }
    .cx-table th, .cx-table td{ border-bottom:1px solid rgba(127,127,127,.25); padding:6px 8px; vertical-align: top; }
    .cx-table th{ text-align:left; position:sticky; top:0; background:inherit; }

    @media (prefers-reduced-motion: no-preference) {
      @keyframes pc-pulse-brief { 0%{transform:scale(1)} 40%{transform:scale(1.08)} 100%{transform:scale(1)} }
      .btn-pulse { animation: pc-pulse-brief 0.9s ease-out; }
    }
  </style>
</head>

<body class="page-fade">
  <!-- Header -->
  <header class="site-header">
    <div class="brand-wrap">
      <div class="brand-grid">
        <img src="./assets/PC-Logo.png" alt="polycode" class="brand-logo" loading="lazy" decoding="async" />
        <div class="brand-title2">polycode</div>
        <div class="brand-tagline2">learn<span class="dot">.</span>code<span class="dot">.</span>execute</div>
      </div>
    </div>
    <nav class="site-nav">
      <a href="./index.html">Home</a>
      <a href="./about.html">About</a>
      <a href="./contact.html">Contact</a>
    </nav>
  </header>

  <!-- App -->
  <div class="stage">
    <div class="app" id="appGrid">
      <section class="panel left" id="leftPanel">
        <div class="pane-head">
          <select id="langSelect" class="select" aria-label="Choose language" onchange="location.href=this.value">
            <option value="./index-c.html" selected>C</option>
            <option value="./index-cpp.html">C++</option>
            <option value="./index-web.html">HTML/CSS/JS</option>
            <option value="./index-java.html">Java</option>
            <option value="./index-sql.html">SQL (MySQL/SQLite)</option>
          </select>
        </div>
        <div class="pane-body"><div id="leftContent" style="margin-top:12px;"></div></div>
        <div class="pane-foot"><span class="msg" id="leftFoot">About C</span></div>
      </section>

      <div class="v-resize"><div id="dragLeft"></div></div>

      <section class="panel center" id="centerPanel">
        <div class="pane-head">
          <button id="themeToggle" class="btn theme-btn" title="Toggle theme" aria-label="Toggle theme">
            <svg viewBox="0 0 24 24" id="themeIcon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
          </button>
          <span class="title" id="centerTitle" style="margin-left:8px;">C – Editor | Polycode</span>
          <div class="right-controls" style="margin-left:auto; display:flex; gap:8px; align-items:center;">
            <button id="btnSaveFile" class="btn" title="Save (Ctrl/Cmd + S)" aria-label="Save">
              <svg viewBox="0 0 24 24"><path d="M17 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V7l-4-4zm-5 16a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm3-10H6V5h9v4z" fill="currentColor"/></svg>
            </button>
            <button id="btnSharePdf" class="btn" title="Share PDF" aria-label="Share PDF">
              <svg viewBox="0 0 24 24"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8h-2v8H6v-8H4zm8-10-5.5 5.5L8.91 9 11 6.91V16h2V6.91L15.09 9l2.41-1.5L12 2z" fill="currentColor"/></svg>
            </button>
            <button id="btnRun" class="btn primary attn" title="Execute (Click or Press F9)" aria-label="Run">
              <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
            </button>
          </div>
        </div>
        <div id="editor"></div>
        <div class="pane-foot"><span class="msg" id="centerFoot">Ready for Execution</span></div>
      </section>

      <div class="v-resize right"><div id="dragRight"></div></div>

      <section class="panel right" id="rightPanel">
        <div class="pane-head">
          <span class="title">C – Console | Polycode</span>
          <div class="right-controls" style="margin-left:auto; display:flex; align-items:center;">
            <button id="btnComplexity" class="btn" title="Analyze Time & Space" aria-label="Complexity" disabled>
              <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
                <circle cx="12" cy="12" r="7" fill="none" stroke="currentColor" stroke-width="2"/>
                <path d="M9 9.5c.9-1 2-1.5 3-1.5s2.1.5 3 1.5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
              <span class="sr-only">Complexity</span>
            </button>
            <button id="btnReset" class="btn" title="Reset (Click or Press F10)" aria-label="Reset">
              <svg viewBox="0 0 24 24"><path d="M12 6v3l4-4-4-4v3C7.58 4 4 7.58 4 12s3.58 8 8 8a8 8 0 007.39-4.91l-1.85-.77A6 6 0 1112 6z"/></svg>
            </button>
          </div>
        </div>

        <div id="output" class="screen-dim" style="padding:12px;">
          <pre id="jconsole" class="console" style="margin:0;"></pre>

          <div id="consoleRow" style="display:none; margin-top:0; gap:4px; align-items:baseline; font:14px/1.4 ui-monospace, Menlo, Consolas, monospace;">
            <span id="consolePrefix"></span>
            <span id="consoleInput" contenteditable="true" spellcheck="false"></span>
          </div>
        </div>

        <div class="pane-foot"><span class="msg" id="rightFoot">Waiting for Execution</span></div>
      </section>
    </div>
  </div>

  <div class="chevron-tab" id="chevronTab" title="Toggle left panel">
    <svg viewBox="0 0 24 24"><path d="M9.29 6.71a1 1 0 011.42 0L15 11l-4.29 4.29a1 1 0 11-1.42-1.42L12.17 11 9.29 8.12a1 1 0 010-1.41z"/></svg>
  </div>

  <!-- Footer -->
  <footer class="site-footer">
    <div class="footer-grid">
      <div class="footer-left">
        <img src="./assets/logo.png" alt="Edifica" class="footer-logo" loading="lazy" decoding="async" />
        <div class="txt">
          <span class="powered">powered by edifica</span>
          <span class="subline">education<span class="dot">.</span>consultation<span class="dot">.</span>assistance</span>
          <div class="siteurl"><a href="https://www.edifica.in" target="_blank" rel="noopener">www.edifica.in</a></div>
        </div>
      </div>
      <div class="footer-center">
        <span class="label">Follow us</span>
        <a class="social" href="https://facebook.com/edifica.facebook" target="_blank" rel="noopener" aria-label="Facebook" title="Facebook">
          <svg viewBox="0 0 24 24" width="18" height="18"><path d="M22 12.07C22 6.48 17.52 2 11.93 2S2 6.48 2 12.07c0 5.01 3.66 9.16 8.44 9.93v-7.03H7.9v-2.9h2.54V9.41c0-2.5 1.49-3.89 3.77-3.89 1.09 0 2.24.2 2.24.2v2.47h-1.26c-1.24 0-1.63.77-1.63 1.56v1.88h2.78l-.44 2.9h-2.34v7.03C18.34 21.23 22 17.08 22 12.07z"/></svg>
        </a>
        <a class="social" href="https://instagram.com/edifica.ig" target="_blank" rel="noopener" aria-label="Instagram" title="Instagram">
          <svg viewBox="0 0 24 24" width="18" height="18"><path d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zm5 5a5 5 0 1 0 0 10 5 5 0 0 0 0-10zm6.5-.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM12 9.5A2.5 2.5 0 1 1 9.5 12 2.5 2.5 0 0 1 12 9.5z"/></svg>
        </a>
        <a class="social" href="https://youtube.com/@edifica.youtube" target="_blank" rel="noopener" aria-label="YouTube" title="YouTube">
          <svg viewBox="0 0 24 24" width="18" height="18"><path d="M23.5 6.2a3 3 0 0 0-2.1-2.1C19.4 3.5 12 3.5 12 3.5s-7.4 0-9.4.6A3 3 0 0 0 .5 6.2 31.7 31.7 0 0 0 0 12a31.7 31.7 0 0 0 .6 5.8 3 3 0 0 0 2.1 2.1c.4-1.9.6-3.9.6-5.8 0-1.9-.2-3.9-.6-5.8zM9.6 15.5V8.5L16 12l-6.4 3.5z"/></svg>
        </a>
      </div>
      <div class="footer-right">
        <a href="./privacy.html">Privacy Policy</a>
        <a href="./terms.html">Terms &amp; Conditions</a>
        <a href="./legal.html">Legal Information</a>
      </div>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs/loader.min.js" defer></script>
  <script src="./js/shell.js" defer></script>

  <script>
    // ------------------------ Sample C ------------------------
    const SAMPLE_C =
`#include <stdio.h>

int main(){
    int n;
    printf("Enter a number: ");
    if (scanf("%d", &n) != 1) return 0;
    printf("Square = %d\\n", n*n);
    return 0;
}`;

    // ------------------------ Resizers ------------------------
    const SIZE_KEY = 'pc:c:sizes';
    function gridColTemplate(L, g1, C, g2, R){ return `${L}px ${g1}px ${C}px ${g2}px ${R}px`; }

    function initResizers(){
      const app = document.getElementById('appGrid');
      const left = document.getElementById('leftPanel');
      const center = document.getElementById('centerPanel');
      const right = document.getElementById('rightPanel');
      const g1El = document.querySelector('.v-resize:not(.right)');
      const g2El = document.querySelector('.v-resize.right');
      if (!app || !left || !center || !right || !g1El || !g2El) return;

      const g1 = Math.max(6, Math.round(g1El.getBoundingClientRect().width || 8));
      const g2 = Math.max(6, Math.round(g2El.getBoundingClientRect().width || 8));

      const compute = () => {
        const total = app.getBoundingClientRect().width;
        const L = left.getBoundingClientRect().width;
        const R = right.getBoundingClientRect().width;
        const C = Math.max(320, total - L - R - g1 - g2);
        return { L, C, R };
      };

      function applyCols(cols){
        app.style.gridTemplateColumns = gridColTemplate(cols.L, g1, cols.C, g2, cols.R);
      }

      // restore or init
      const saved = localStorage.getItem(SIZE_KEY);
      if (saved){
        try{ applyCols(JSON.parse(saved)); }catch{ applyCols(compute()); }
      } else {
        applyCols(compute());
      }

      const clamp = (v, min, max) => Math.max(min, Math.min(max, v));
      const minL = 200, minR = 240, minC = 320;

      function startDrag(which, startX){
        const rect = app.getBoundingClientRect();
        const total = rect.width;
        // current columns
        const cs = getComputedStyle(app).gridTemplateColumns.split(' ').map(x => parseFloat(x));
        let [L, , C, , R] = cs;

        function onMove(e){
          const dx = e.clientX - startX;
          let nL=L, nC=C, nR=R;
          if (which==='left'){
            nL = clamp(L + dx, minL, total - g1 - g2 - minC - minR);
            nC = total - nL - g1 - g2 - nR;
            if (nC < minC){ nC = minC; nL = total - g1 - g2 - nC - nR; }
          } else {
            nR = clamp(R - dx, minR, total - g1 - g2 - minC - minL);
            nC = total - L - g1 - g2 - nR;
            if (nC < minC){ nC = minC; nR = total - L - g1 - g2 - nC; }
          }
          applyCols({ L:nL, C:nC, R:nR });
        }
        function onUp(){
          window.removeEventListener('mousemove', onMove);
          window.removeEventListener('mouseup', onUp);
          const cs = getComputedStyle(app).gridTemplateColumns.split(' ').map(x => parseFloat(x));
          const cols = { L:cs[0], C:cs[2], R:cs[4] };
          localStorage.setItem(SIZE_KEY, JSON.stringify(cols));
        }
        window.addEventListener('mousemove', onMove);
        window.addEventListener('mouseup', onUp);
      }
      document.getElementById('dragLeft')?.addEventListener('mousedown', (e)=> startDrag('left',  e.clientX));
      document.getElementById('dragRight')?.addEventListener('mousedown', (e)=> startDrag('right', e.clientX));
      window.addEventListener('resize', ()=> {
        // keep center >= minC on window resize
        const cs = getComputedStyle(app).gridTemplateColumns.split(' ').map(x => parseFloat(x));
        const [L, , C, , R] = cs;
        const total = app.getBoundingClientRect().width;
        const newC = Math.max(minC, total - L - R - g1 - g2);
        app.style.gridTemplateColumns = gridColTemplate(L, g1, newC, g2, R);
      });
    }

    // ------------------------ Status ticker ------------------------
    let __tickerRAF=null, __tickStart=0, __tickerLabel='';
    function startStatusTicker(label){
      stopStatusTicker();
      __tickerLabel = label;
      __tickStart = performance.now();
      const right = document.getElementById('rightFoot');
      const center = document.getElementById('centerFoot');
      const loop = () => {
        const s = (performance.now() - __tickStart) / 1000;
        const t = s < 10 ? s.toFixed(2) : s.toFixed(1);
        const msg = `${__tickerLabel}   Time: ${t} second(s)`;
        if (right) right.textContent = msg;
        if (center) center.textContent = msg;
        __tickerRAF = requestAnimationFrame(loop);
      };
      loop();
    }
    function stopStatusTicker(){ if (__tickerRAF){ cancelAnimationFrame(__tickerRAF); __tickerRAF=null; } }
    function setStatusBoth(text, kind){
      window.PolyShell?.setStatus(text, kind);
      const right = document.getElementById('rightFoot');
      const center = document.getElementById('centerFoot');
      if (right) right.textContent  = text;
      if (center) center.textContent = text;
    }

    // ------------------------ Monaco helpers ------------------------
    function clearCompileMarkers(){
      try{
        const model = window.editor?.getModel();
        if (model && window.monaco) window.monaco.editor.setModelMarkers(model, 'c-compile', []);
      }catch{}
    }
    function setCompileMarkersFromGccLog(log){
      try{
        const model = window.editor?.getModel();
        if (!model || !window.monaco) return;
        const markers = [];
        const re = /main\.c:(\d+):(\d+):\s*(?:fatal error|error|warning):\s*([^\n]+)/g;
        let m;
        while ((m = re.exec(log))){
          const line = +m[1], col = +m[2];
          markers.push({
            startLineNumber: line, startColumn: Math.max(1,col),
            endLineNumber: line, endColumn: Math.max(1,col+1),
            message: m[3], severity: monaco.MarkerSeverity.Error, source:'gcc'
          });
        }
        monaco.editor.setModelMarkers(model, 'c-compile',
          markers.length ? markers : [{
            startLineNumber:1, startColumn:1, endLineNumber:1, endColumn:1,
            message:'Compilation failed', severity: monaco.MarkerSeverity.Error
          }]);
      }catch(e){ console.warn('marker set failed', e); }
    }

    // ------------------------ Console helpers ------------------------
    function scrollOutputToEnd(){
      const out = document.getElementById('output');
      const pre = document.getElementById('jconsole');
      if (out){ out.scrollTop = out.scrollHeight; out.scrollLeft = out.scrollWidth; }
      if (pre){ pre.scrollTop = pre.scrollHeight; pre.scrollLeft = pre.scrollWidth; }
    }
    function setConsole(text){
      const el = document.getElementById('jconsole');
      if (!el) return;
      el.textContent = text || '';
      scrollOutputToEnd();
    }
    function termWrite(t){
      const el = document.getElementById('jconsole');
      if (!el) return;
      el.textContent += t;
      scrollOutputToEnd();
    }

    function showInputRow(show){
      const row = document.getElementById('consoleRow');
      const pre = document.getElementById('jconsole');
      const prefix = document.getElementById('consolePrefix');
      if (!row || !pre || !prefix) return;
      row.style.display = show ? 'flex' : 'none';
      if (show){
        const txt = pre.textContent; const i = txt.lastIndexOf('\n'); const tail = txt.slice(i+1);
        if (tail && !/^\s*$/.test(tail)){ prefix.textContent = tail + ' '; pre.textContent = txt.slice(0, i+1); }
        else { prefix.textContent = ''; }
        const el = document.getElementById('consoleInput');
        if (el){ el.focus(); const r = document.createRange(); r.selectNodeContents(el); r.collapse(false); const s = window.getSelection(); s.removeAllRanges(); s.addRange(r); }
        setStatusBoth('Waiting for Input…','busy'); startStatusTicker('Waiting for Input…');
      } else {
        if (prefix.textContent){ pre.textContent += prefix.textContent; prefix.textContent = ''; }
      }
      scrollOutputToEnd();
    }

    function codeNeedsInput(src){ return /\bscanf\s*\(|\bgetchar\s*\(|\bfgets\s*\(|\bfscanf\s*\(/.test(src); }
    document.addEventListener('keydown', (e)=>{
      const el = document.getElementById('consoleInput');
      if (!el || el.offsetParent === null) return;
      if (e.target !== el) return;
      if (e.key === 'Enter'){
        e.preventDefault();
        const line = el.textContent + '\n';
        if (window.termWS && window.termWS.readyState === 1 && window.wsRunInFlight){
          try{ window.termWS.send(JSON.stringify({ type:'stdin', data: line })); }catch{}
        }
        termWrite(line);
        el.textContent = '';
        setStatusBoth('Execution in Progress…','busy'); startStatusTicker('Execution in Progress…');
      }
    }, true);

    // ------------------------ Runner endpoints ------------------------
    const C_API_BASE = 'https://polycode-cc.onrender.com';
    const C_WS_URL   = 'wss://polycode-cc.onrender.com/cc';

    async function prepare(){
      const code = window.editor ? window.editor.getValue() : '';
      const files = [{ path: 'main.c', content: code }];
      const res = await fetch(C_API_BASE + '/api/cc/prepare', {
        method:'POST', headers:{ 'Content-Type':'application/json' },
        body: JSON.stringify({ lang:'c', files, entry:'main.c', output:'a.out' })
      });
      if (!res.ok) throw new Error('Prepare failed: ' + res.status);
      return res.json();
    }

    // Heartbeat (optional safety)
    let hbInterval = null, hbTimeout = null;
    function startHeartbeat(ws){
      stopHeartbeat();
      hbInterval = setInterval(()=>{ try{ if (ws.readyState===1){ ws.send(JSON.stringify({type:'ping'})); clearTimeout(hbTimeout); hbTimeout = setTimeout(()=>{ console.warn('Runner heartbeat missed'); }, 5000); } }catch{} }, 25000);
    }
    function stopHeartbeat(){ if (hbInterval){ clearInterval(hbInterval); hbInterval=null; } if (hbTimeout){ clearTimeout(hbTimeout); hbTimeout=null; } }

    // ------------------------ Main run ------------------------
    window.runLang = async function runLang(){
      setConsole(''); document.getElementById('output')?.classList.remove('error');
      window.setComplexityEnabled?.(false);
      try{ window.termWS?.close(); }catch{} window.termWS = null; window.wsRunInFlight = false;
      clearCompileMarkers();
      setStatusBoth('Compiling…','busy'); startStatusTicker('Compiling…');

      // CONNECT OVERLAY (optional visual)
      const overlay = document.getElementById('runnerOverlay');
      const msg = document.getElementById('runnerMsg');
      const hint = document.getElementById('runnerHint');
      if (overlay){ overlay.style.display='flex'; if(msg) msg.textContent='Connecting to C runner…'; if(hint) hint.textContent='Warming up backend…'; }

      // Prepare
      let prep;
      try { prep = await prepare(); }
      catch(e){
        stopStatusTicker();
        setConsole((e && e.message) || 'Prepare failed');
        setStatusBoth('Execution Failed','error');
        if (overlay) overlay.style.display='none';
        return;
      }

      if (!prep || !prep.ok || !prep.token){
        stopStatusTicker();
        const log = (prep && (prep.compileLog||prep.stderr||prep.stdout)) || 'Compilation failed.';
        setConsole((log||'').trim());
        setCompileMarkersFromGccLog(log);
        setStatusBoth('Execution Failed','error');
        if (overlay) overlay.style.display='none';
        return;
      }

      clearCompileMarkers();

      // Open WS
      const token = prep.token;
      const ws = new WebSocket(C_WS_URL + '?token=' + encodeURIComponent(token));
      window.termWS = ws; window.wsRunInFlight = true;
      const needsStdin = codeNeedsInput(window.editor ? window.editor.getValue() : '');
      let lastExitCode = null;

      ws.addEventListener('open', ()=>{
        startHeartbeat(ws);
        if (overlay) overlay.style.display='none';
        setStatusBoth(needsStdin ? 'Waiting for Input…' : 'Execution in Progress…','busy');
        startStatusTicker(needsStdin ? 'Waiting for Input…' : 'Execution in Progress…');
        showInputRow(needsStdin);
      });

      ws.addEventListener('message', (ev)=>{
        const data = String(ev.data||'');
        termWrite(data);
        const m = data.match(/\[process exited with code\s+(-?\d+)\]/);
        if (m) lastExitCode = parseInt(m[1],10);
      });

      ws.addEventListener('error', ()=>{ termWrite('\n[connection error]\n'); });

      ws.addEventListener('close', ()=>{
        stopHeartbeat();
        window.wsRunInFlight = false; showInputRow(false);
        stopStatusTicker();
        if (typeof lastExitCode === 'number'){
          if (lastExitCode === 0){
            setStatusBoth('Executed Successfully','ok'); window.setComplexityEnabled?.(true);
          } else {
            document.getElementById('output')?.classList.add('error');
            setStatusBoth('Executed with Error','error');
          }
        } else {
          setStatusBoth('Execution Finished','ok'); window.setComplexityEnabled?.(true);
        }
      }, { once:true });
    };

    window.clearLang = function clearLang(){
      setConsole('');
      try{ window.termWS?.close(); }catch{}
      window.termWS = null; window.wsRunInFlight = false;
      showInputRow(false);
      stopStatusTicker();
      window.setComplexityEnabled?.(false);
      setStatusBoth('Ready','ok');
    };

    // ------------------------ Bootstrap ------------------------
    window.bootstrap = async function bootstrap(){
      await window.PolyShell.initMonaco({ value: SAMPLE_C, language: 'c' });
      initResizers();
      setStatusBoth('Ready','ok');
      window.PolyShell.loadLeftContent?.('c');
      window.setComplexityEnabled?.(false);
    };

    (function startWhenReady(){
      function start(){
        if (!window.PolyShell){
          const id = setInterval(()=>{ if (window.PolyShell){ clearInterval(id); window.bootstrap(); } }, 25);
          setTimeout(()=>clearInterval(id), 3000);
          return;
        }
        window.bootstrap();
      }
      if (document.readyState === 'loading'){ document.addEventListener('DOMContentLoaded', start, { once:true }); } else { start(); }
    })();
  </script>

  <!-- Runner overlay -->
  <div id="runnerOverlay" style="position: fixed; inset: 0; display: none; align-items: center; justify-content: center; background: rgba(0,0,0,0.45); z-index: 9999;">
    <div style="min-width: 280px; max-width: 420px; padding: 16px 18px; border-radius: 12px; background: var(--panel, #111); color: inherit; box-shadow: 0 6px 24px rgba(0,0,0,0.35); font: 14px/1.4 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto;">
      <div id="runnerMsg" style="font-weight:600; margin-bottom:8px;">Connecting to C runner…</div>
      <div style="height:8px; background: rgba(255,255,255,0.15); border-radius: 999px; overflow:hidden;"><div id="runnerBar" style="height:100%; width:18%; background: currentColor; opacity:0.9;"></div></div>
      <div id="runnerHint" style="margin-top:8px; opacity:0.8;">Warming up backend…</div>
    </div>
  </div>

  <!-- Complexity modal -->
  <div class="pc-modal" id="cxModal" aria-hidden="true">
    <div class="pc-modal__backdrop" data-close></div>
    <div class="pc-modal__dialog">
      <div class="pc-modal__header">
        <div class="pc-modal__title">Time Complexity (C)</div>
        <button class="pc-modal__x" data-close aria-label="Close">×</button>
      </div>
      <div class="pc-modal__body">
        <div class="cx-summary" id="cxSummary"></div>
        <hr/>
        <table class="cx-table" id="cxTable"><thead><tr><th>Line</th><th>Type</th><th>Complexity</th><th>Reason</th></tr></thead><tbody></tbody></table>
        <div class="cx-notes" id="cxNotes"></div>
      </div>
      <div class="pc-modal__footer"><button class="btn" data-close>Close</button></div>
    </div>
  </div>
  <script>
    document.addEventListener('click', (e)=>{ const t = e.target; if (t && t.matches('[data-close]')){ document.getElementById('cxModal')?.setAttribute('aria-hidden','true'); } });
    document.getElementById('btnComplexity')?.addEventListener('click', ()=>{
      document.getElementById('cxModal')?.setAttribute('aria-hidden','false');
      window.PolyShell?.setStatus('Analyzing…'); setTimeout(()=> window.PolyShell?.setStatus('Ready','ok'), 400);
    });
  </script>

  <script src="./js/complexityc.js" defer></script>
</body>
</html>
